@model ClientSphere.ViewModels.MarketingDashboardViewModel

@{
    ViewData["Title"] = "Marketing Campaigns";
    Layout = "~/Views/Shared/_CrmLayout.cshtml";
    ViewData["CurrentPage"] = "Marketing";
    ViewData["HideTopNavTitle"] = true;
}

@{
    var isCampaignArchived = Context.Request.Query["archived"].ToString() == "1";
}


    <!-- Status Tabs -->
    <ul class="nav nav-tabs mb-3">
        <li class="nav-item">
            <a class="nav-link @(!isCampaignArchived ? "active fw-bold" : "")" href="?archived=0">
                <i class="bi bi-megaphone me-1"></i> Active Campaigns
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link @(isCampaignArchived ? "active fw-bold" : "")" href="?archived=1">
                <i class="bi bi-archive me-1"></i> Archived
            </a>
        </li>
    </ul>

    <!-- Create Campaign Button row -->
    <div class="d-flex justify-content-end mb-4">
        <a asp-action="Create" class="btn btn-primary px-4">
            <i class="bi bi-plus-lg me-2"></i>Create New Campaign
        </a>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="icon-shape bg-secondary-subtle text-secondary rounded-3 p-3 me-3">
                        <i class="bi bi-megaphone h4 mb-0"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Total Campaigns</div>
                        <h3 class="fw-bold mb-0 text-info">@Model.TotalCampaigns</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="icon-shape bg-secondary-subtle text-secondary rounded-3 p-3 me-3">
                        <i class="h4 mb-0 fw-bold">&#8369;</i>
                    </div>
                    <div>
                        <div class="text-muted small">Active Budget</div>
                        <h3 class="fw-bold mb-0 text-success">&#8369;@Model.ActiveBudget.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
             <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="icon-shape bg-secondary-subtle text-secondary rounded-3 p-3 me-3">
                        <i class="bi bi-people h4 mb-0"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Total Recipients</div>
                        <h3 class="fw-bold mb-0 text-primary">@Model.TotalRecipients.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
             <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="icon-shape bg-secondary-subtle text-secondary rounded-3 p-3 me-3">
                        <i class="bi bi-graph-up h4 mb-0"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Avg Response Rate</div>
                        <h3 class="fw-bold mb-0 text-warning">@Model.AvgResponseRate%</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search & Filter -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-2">
            <div class="input-group">
                <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-search text-muted"></i></span>
                <input type="text" class="form-control border-0" placeholder="Search campaigns by name or ID...">
                <button class="btn btn-light border-start rounded-0 px-4" type="button"><i class="bi bi-funnel me-2"></i> All Status</button>
                <button class="btn btn-light border-start rounded-0 px-4" type="button">All Types</button>
            </div>
        </div>
    </div>

    <!-- Campaigns List -->
    <div class="row">
        @foreach (var campaign in Model.Campaigns)
        {
             <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="d-flex align-items-center">
                                <div class="icon-shape bg-secondary-subtle text-secondary rounded-3 p-3 me-3 d-flex align-items-center justify-content-center">
                                    <i class="bi bi-send h5 mb-0"></i>
                                </div>
                                <div>
                                    <h5 class="fw-bold mb-0">@campaign.Name</h5>
                                    <div class="text-muted small">@campaign.CampaignId</div>
                                </div>
                            </div>
                            @if(campaign.Status == "Active") { <span class="badge bg-success-subtle text-success rounded-pill px-3">Active</span> }
                            else if(campaign.Status == "Completed") { <span class="badge bg-secondary-subtle text-secondary rounded-pill px-3">Completed</span> }
                            else { <span class="badge bg-light text-dark rounded-pill px-3">@campaign.Status</span> }
                        </div>

                        <div class="row mb-3">
                             <div class="col-6">
                                <div class="small text-muted">Type</div>
                                <div class="fw-bold">@campaign.Type</div>
                            </div>
                            <div class="col-6 text-end">
                                <div class="small text-muted">Budget</div>
                                <div class="fw-bold">&#8369;@campaign.Budget.ToString("N0")</div>
                            </div>
                        </div>

                         <div class="row mb-3">
                             <div class="col-6">
                                <div class="small text-muted">Start Date</div>
                                <div class="fw-bold">@campaign.StartDate.ToString("yyyy-MM-dd")</div>
                            </div>
                            <div class="col-6 text-end">
                                <div class="small text-muted">End Date</div>
                                <div class="fw-bold">@campaign.EndDate.ToString("yyyy-MM-dd")</div>
                            </div>
                        </div>

                        <hr class="my-3 opacity-25"> 

                        <div class="row text-center mb-3">
                             <div class="col-4 border-end">
                                <div class="small text-muted">Recipients</div>
                                <div class="fw-bold">@campaign.Recipients.ToString("N0")</div> 
                            </div>
                            <div class="col-4 border-end">
                                <div class="small text-muted">Responses</div>
                                <div class="fw-bold">@campaign.Responses</div>
                            </div>
                             <div class="col-4">
                                <div class="small text-muted">Response Rate</div>
                                <div class="fw-bold text-success">@campaign.ResponseRate%</div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center pt-2">
                             <div class="d-flex align-items-center">
                                <div class="avatar-circle-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 30px; height: 30px; font-size: 0.8rem;">
                                    @campaign.ManagedBy.Substring(0, 1)M
                                </div>
                                <div class="small text-muted">Managed by <br> @campaign.ManagedBy</div>
                             </div>
                            
                             <a asp-action="Edit" asp-route-id="@campaign.Id" class="btn btn-sm btn-outline-primary rounded-pill px-3 me-2">
                                <i class="bi bi-pencil-square me-1"></i> Edit
                            </a>
                            <a asp-action="Delete" asp-route-id="@campaign.Id" class="btn btn-sm btn-outline-danger rounded-pill px-3">
                                <i class="bi bi-trash me-1"></i> Delete
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
